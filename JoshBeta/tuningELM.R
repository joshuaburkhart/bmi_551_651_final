# BMI 651: Tuning ELM

library(MASS)
library(plyr) #this must be loaded before dplyr
library(dplyr)
library(ggplot2)
library(broom)
library(knitr)
library(magrittr)
library(reshape2)
library(infotheo)
library(stats)
library(car)
library(e1071)
library(bnlearn)
library(elmNN)
library(gbm)
library(stats)
set.seed(2013)

setwd("~/SoftwareProjects/bmi_551_651_final/JoshBeta")

# gene id cols, cell line rows
expression <-
read.table(
"../data/expression.tsv",header = TRUE,sep = "\t",quote = "",row.names =
1,check.names = FALSE,stringsAsFactors = FALSE
)

# subtype cols, cell line rows
subtypes <-
read.table(
"../data/subtypes.txt",header = TRUE,sep = "\t",row.names = 1,check.names =
TRUE
)
subtypes[,1] <- subtypes[,1] %>% as.numeric()

for (subtype_num in 1:max(subtypes[,1]))
{
    zeros <- rep(0,nrow(subtypes))
    zeros[which(subtypes[,1] %>% as.numeric() == subtype_num)] <- 1
    subtypes <- cbind(subtypes,zeros)
}

# drug cols, cell line rows
training.classes <-
t(
read.table(
"../data/training_set_answers.txt",header = TRUE,sep = "\t",check.names = FALSE
)
)
training.classes[,1:ncol(training.classes)] <-
training.classes[,1:ncol(training.classes)] %>% as.numeric()

# Usage, id, drug, cell line columns, values in rows
scoring_and_test_set_id_mappings <-
read.table(
"../data/scoring_and_test_set_id_mappings.csv",header = TRUE,sep = ",",check.names =
FALSE
)

sae <- expression

for (subtype_num in 2:(max(subtypes[,1]) + 1))
{
    # organize subtypes, expression, train, test, classes...
    subtype_df <-
    data.frame(t(subtypes[,subtype_num]),check.names = FALSE)
    colnames(subtype_df) <- colnames(expression)
    sae <- rbind(subtype_df,sae)
}

# split training data and kaggle holdout
training.features <- sae[,colnames(training.classes)]
kaggle.features <-
sae[setdiff(colnames(sae),colnames(training.classes))]

### Scan for missing Data

sum(is.na(training.features))
sum(is.na(kaggle.features))

sum(is.na(training.classes))

print("Loading feature indeces...")
x.all_features <- vector("list",12)
x.all_features[[1]] <-
c(
330,431,439,586,827,833,889,1243,1260,1263,1268,2720,3013,3510,3875,3980,4011,4544,4643,4768,4801,4851,4985,5108,5580,5974,6011,6065,6097,7152,7177,7275,7883,8039,8226,8704,8817,9043,9660,9670,9969,10217,10483,10554,10815,11624,12168,12190,12252,12454,12637,12875,12900,13093,13639,13835,13969,13998,14370,14424,14523,14924,15213,15682,15974,16297,16339,16925,17222,17296,17449,17525,17759
)
x.all_features[[2]] <-
c(
10,14,37,102,128,132,140,144,152,189,193,199,219,236,239,244,257,298,330,336,349,357,364,375,396,409,445,456,459,464,470,499,513,519,530,572,575,649,681,686,687,699,707,725,779,791,793,801,802,813,829,868,870,903,944,972,988,1010,1020,1050,1064,1076,1086,1087,1088,1089,1090,1106,1169,1173,1205,1257,1303,1304,1334,1384,1403,1419,1437,1444,1471,1483,1514,1569,1572,1589,1596,1600,1627,1640,1641,1654,1657,1700,1724,1761,1772,1814,1818,1828,1830,1837,1845,1865,1891,1898,1901,1919,1938,1942,1967,1968,1973,1983,1986,1992,2032,2061,2062,2064,2076,2086,2103,2104,2122,2137,2157,2163,2203,2299,2306,2308,2334,2336,2377,2383,2422,2437,2445,2457,2464,2465,2475,2516,2537,2545,2551,2561,2607,2614,2646,2654,2657,2659,2665,2682,2693,2694,2696,2708,2723,2728,2753,2777,2792,2794,2799,2810,2818,2822,2847,2855,2865,2894,2903,2910,2913,2917,2945,2959,2988,3007,3010,3021,3024,3104,3107,3131,3186,3188,3222,3255,3284,3287,3297,3300,3393,3396,3416,3452,3456,3461,3530,3535,3629,3634,3645,3650,3683,3714,3738,3750,3763,3767,3779,3793,3825,3868,3883,3906,3930,3966,4019,4030,4083,4125,4138,4145,4153,4160,4166,4206,4212,4214,4220,4236,4241,4274,4324,4328,4342,4359,4361,4394,4460,4466,4471,4483,4522,4529,4530,4537,4558,4567,4585,4600,4637,4654,4665,4670,4682,4690,4738,4766,4776,4779,4785,4838,4870,4876,4882,4887,4897,4900,4928,4953,5036,5048,5053,5062,5064,5083,5092,5094,5101,5142,5168,5170,5192,5201,5248,5250,5256,5269,5301,5314,5373,5375,5383,5448,5450,5459,5467,5559,5576,5582,5603,5639,5667,5682,5689,5732,5751,5772,5821,5849,5875,5879,5883,5885,5892,5900,5904,5906,5914,5916,5937,5965,5985,6018,6032,6041,6056,6061,6094,6098,6114,6120,6125,6163,6225,6262,6263,6281,6317,6329,6334,6335,6355,6356,6363,6384,6393,6401,6407,6408,6497,6511,6575,6580,6590,6592,6607,6623,6644,6660,6672,6674,6681,6730,6850,6860,6879,6882,6902,6940,6958,6980,6993,6996,7004,7051,7074,7106,7139,7162,7195,7196,7199,7202,7222,7244,7257,7259,7282,7287,7288,7295,7332,7391,7404,7418,7429,7473,7508,7513,7536,7545,7549,7568,7569,7580,7582,7594,7608,7625,7682,7688,7695,7699,7709,7722,7733,7735,7751,7793,7799,7829,7832,7854,7855,7857,7872,7884,7891,7912,7916,7942,7945,7946,7952,7959,8035,8041,8048,8067,8097,8118,8119,8142,8237,8255,8274,8320,8355,8368,8372,8375,8382,8394,8500,8520,8521,8532,8561,8597,8604,8618,8631,8641,8642,8654,8694,8703,8742,8747,8787,8797,8857,8862,8867,8886,8926,8931,8949,9035,9058,9062,9091,9127,9139,9142,9158,9191,9222,9223,9254,9257,9274,9284,9286,9329,9340,9353,9354,9357,9368,9399,9402,9406,9429,9462,9523,9531,9536,9569,9596,9636,9678,9690,9707,9717,9748,9763,9768,9789,9837,9841,9850,10007,10014,10025,10026,10074,10076,10113,10140,10153,10166,10177,10215,10220,10230,10232,10261,10268,10375,10403,10411,10434,10435,10470,10472,10484,10489,10524,10540,10542,10595,10695,10718,10775,10789,10799,10808,10832,10848,10857,10870,10901,10919,10974,10990,11003,11019,11038,11039,11040,11044,11102,11106,11173,11179,11180,11201,11215,11224,11241,11245,11255,11258,11260,11272,11273,11302,11304,11307,11313,11320,11337,11355,11389,11393,11405,11417,11431,11433,11435,11468,11477,11498,11512,11514,11536,11540,11570,11587,11619,11663,11686,11705,11711,11739,11749,11785,11808,11816,11868,11876,11884,11887,11888,11897,11903,11905,11910,11925,11931,11946,11975,11986,11991,11996,12035,12036,12040,12041,12056,12061,12066,12073,12128,12133,12136,12230,12252,12286,12337,12348,12350,12351,12398,12407,12425,12431,12451,12475,12486,12491,12516,12524,12537,12543,12554,12560,12572,12647,12666,12701,12735,12780,12787,12798,12838,12872,12916,12917,12922,12959,12976,12986,12994,13012,13014,13022,13078,13138,13165,13180,13199,13207,13254,13271,13272,13280,13312,13326,13359,13367,13370,13371,13403,13438,13464,13486,13487,13494,13496,13507,13508,13509,13519,13544,13550,13571,13582,13587,13593,13595,13611,13627,13646,13652,13668,13669,13675,13679,13680,13687,13690,13704,13714,13731,13739,13798,13817,13878,13887,13891,13898,13905,13928,13937,13968,13975,13983,13997,14020,14031,14038,14071,14080,14084,14086,14090,14104,14127,14180,14185,14189,14201,14218,14221,14258,14266,14268,14271,14278,14312,14333,14357,14367,14410,14411,14418,14444,14446,14460,14477,14491,14540,14553,14575,14643,14691,14697,14714,14762,14779,14781,14797,14802,14814,14818,14840,14855,14877,14892,14927,14944,14958,15009,15025,15151,15157,15171,15188,15190,15209,15227,15233,15267,15269,15299,15333,15346,15353,15356,15360,15382,15383,15395,15404,15408,15410,15427,15428,15443,15460,15465,15469,15492,15500,15522,15551,15554,15569,15574,15577,15591,15698,15750,15789,15816,15828,15832,15887,15890,15909,15944,15967,15969,16036,16042,16072,16080,16118,16206,16232,16296,16316,16319,16330,16334,16374,16394,16422,16433,16438,16442,16463,16468,16477,16500,16514,16538,16601,16621,16705,16723,16730,16731,16741,16742,16751,16804,16984,17020,17026,17048,17086,17111,17141,17184,17187,17195,17198,17226,17237,17254,17257,17285,17287,17319,17349,17453,17461,17471,17486,17500,17513,17514,17542,17562,17565,17569,17606,17630,17631,17673,17686,17688,17732,17746,17747,17766,17770,17829,17833,17855,17895,17905,17914,17945,17952,17954,17975,17981,17982,17988,18066,18089,18091,18104,18107,18115,18117,18124,18127,18189,18199,18226,18237,18246,18257,18270,18284,18311,18313,18336,18350,18358,18368,18380,18382,18412,18415,18490,18502,18524,18541,18547,18552,18555,18561,18601,18627
)
x.all_features[[3]] <-
c(
10,11,14,15,20,23,32,37,39,46,57,72,81,85,96,99,102,112,129,132,146,152,163,180,189,193,199,239,244,250,255,257,264,286,287,297,298,310,326,330,336,349,357,359,373,376,383,387,389,409,429,445,456,457,467,469,470,492,499,507,513,519,530,533,575,585,589,602,606,615,628,655,657,667,683,686,687,725,740,743,747,791,801,802,813,840,843,868,903,927,944,946,952,953,972,988,994,1010,1020,1026,1035,1039,1049,1050,1057,1064,1066,1072,1076,1081,1086,1087,1088,1090,1109,1117,1129,1134,1141,1158,1169,1173,1175,1188,1194,1205,1229,1230,1249,1257,1268,1276,1278,1280,1281,1284,1287,1298,1300,1303,1304,1313,1329,1334,1339,1345,1350,1354,1378,1384,1403,1419,1421,1435,1438,1442,1444,1463,1471,1488,1499,1514,1521,1526,1569,1572,1583,1588,1596,1598,1601,1627,1632,1636,1639,1640,1641,1654,1657,1668,1678,1700,1721,1724,1730,1742,1761,1764,1766,1771,1772,1784,1786,1788,1794,1802,1808,1817,1818,1826,1830,1832,1837,1845,1846,1875,1876,1884,1898,1919,1938,1942,1951,1952,1953,1954,1955,1960,1967,1968,1971,1973,1982,1983,1992,2002,2003,2007,2055,2061,2062,2076,2086,2103,2104,2128,2137,2144,2155,2156,2170,2171,2191,2200,2203,2206,2210,2224,2229,2242,2272,2299,2300,2318,2334,2363,2377,2395,2422,2430,2437,2457,2464,2466,2475,2485,2492,2494,2498,2510,2518,2537,2545,2551,2552,2561,2564,2576,2583,2589,2598,2602,2614,2624,2632,2646,2648,2649,2654,2655,2657,2659,2665,2682,2687,2693,2696,2708,2719,2723,2753,2757,2772,2777,2792,2798,2799,2810,2813,2818,2826,2848,2849,2852,2858,2862,2865,2872,2894,2903,2910,2913,2917,2924,2931,2943,2945,2947,2956,2959,2987,2988,2994,3007,3010,3016,3024,3052,3060,3074,3076,3080,3094,3095,3103,3104,3105,3107,3112,3127,3130,3131,3143,3179,3181,3185,3186,3188,3199,3200,3220,3255,3256,3278,3284,3287,3297,3300,3301,3311,3313,3319,3325,3333,3348,3353,3393,3401,3416,3418,3431,3444,3456,3458,3459,3461,3463,3465,3469,3487,3488,3530,3556,3565,3581,3582,3629,3645,3653,3683,3688,3694,3698,3747,3750,3758,3763,3764,3779,3800,3801,3807,3820,3866,3868,3891,3896,3906,3966,3977,3993,4019,4030,4076,4118,4138,4145,4158,4165,4166,4169,4170,4176,4182,4206,4213,4214,4216,4220,4236,4237,4238,4262,4277,4286,4290,4307,4315,4324,4329,4342,4359,4361,4405,4431,4451,4458,4460,4462,4466,4471,4497,4502,4508,4519,4525,4530,4536,4537,4555,4558,4567,4568,4582,4585,4586,4597,4600,4629,4635,4637,4638,4654,4659,4661,4670,4680,4682,4690,4710,4711,4712,4713,4715,4728,4738,4744,4756,4766,4780,4785,4800,4804,4815,4816,4838,4840,4847,4870,4876,4882,4884,4890,4900,4923,4925,4928,4958,4968,4974,4993,4999,5023,5036,5038,5048,5083,5084,5090,5094,5099,5125,5132,5142,5147,5155,5168,5169,5179,5198,5199,5201,5208,5212,5216,5221,5244,5250,5253,5256,5269,5272,5297,5298,5301,5308,5314,5322,5373,5375,5383,5384,5406,5411,5421,5439,5459,5462,5467,5474,5475,5483,5493,5498,5499,5503,5536,5555,5557,5559,5567,5570,5576,5577,5582,5602,5603,5617,5632,5638,5653,5660,5664,5666,5675,5689,5692,5696,5713,5714,5716,5720,5725,5728,5732,5742,5751,5756,5764,5765,5772,5778,5782,5786,5789,5796,5810,5829,5870,5873,5875,5879,5883,5885,5890,5899,5904,5914,5916,5937,5965,5985,5991,5997,6041,6053,6056,6061,6064,6079,6081,6082,6094,6097,6098,6103,6106,6107,6114,6116,6120,6125,6131,6143,6165,6170,6173,6174,6181,6185,6206,6207,6214,6225,6233,6238,6244,6263,6270,6276,6278,6279,6281,6290,6311,6315,6326,6334,6335,6336,6355,6363,6384,6393,6401,6406,6407,6408,6478,6512,6536,6539,6566,6571,6575,6580,6590,6592,6603,6604,6617,6623,6635,6644,6669,6672,6679,6691,6699,6700,6704,6705,6726,6733,6739,6746,6779,6789,6835,6837,6845,6853,6859,6860,6878,6879,6882,6885,6896,6902,6912,6914,6940,6956,6961,6977,6980,6990,7004,7010,7026,7027,7038,7039,7040,7041,7051,7056,7061,7062,7074,7076,7084,7090,7097,7106,7120,7130,7139,7140,7151,7162,7168,7169,7180,7181,7192,7195,7199,7202,7215,7222,7230,7243,7246,7257,7259,7263,7267,7278,7282,7287,7295,7308,7312,7316,7330,7381,7386,7394,7404,7413,7418,7421,7429,7435,7439,7455,7471,7473,7491,7506,7509,7513,7523,7531,7536,7542,7562,7568,7569,7580,7582,7593,7608,7624,7625,7636,7647,7662,7681,7688,7693,7695,7699,7709,7715,7719,7722,7728,7733,7735,7751,7754,7764,7772,7781,7785,7793,7796,7809,7811,7818,7820,7829,7852,7873,7883,7884,7891,7901,7902,7911,7912,7919,7933,7945,7946,7953,7959,7961,7964,7967,7974,7978,8006,8035,8041,8043,8045,8048,8061,8065,8067,8096,8097,8118,8126,8140,8146,8153,8182,8186,8191,8197,8202,8205,8212,8227,8237,8255,8262,8267,8268,8269,8274,8275,8283,8290,8294,8311,8323,8324,8333,8353,8355,8359,8360,8368,8392,8417,8435,8500,8509,8520,8521,8530,8561,8571,8574,8580,8584,8585,8592,8593,8597,8602,8616,8618,8623,8629,8631,8641,8642,8654,8669,8672,8682,8689,8694,8695,8722,8723,8738,8742,8746,8787,8792,8797,8803,8806,8814,8827,8828,8840,8846,8857,8862,8867,8872,8877,8882,8886,8912,8926,8927,8931,8945,8952,8963,8975,8985,9000,9004,9012,9015,9031,9032,9035,9039,9047,9050,9055,9056,9058,9062,9070,9073,9076,9142,9158,9178,9186,9189,9191,9196,9202,9208,9223,9227,9243,9246,9274,9284,9286,9340,9353,9354,9357,9360,9368,9384,9399,9406,9407,9429,9432,9436,9477,9479,9495,9531,9536,9540,9578,9620,9636,9646,9673,9678,9685,9690,9692,9697,9707,9717,9740,9748,9760,9763,9768,9772,9789,9821,9831,9837,9850,9871,9893,9898,9901,9909,9920,9925,9934,9939,9965,9976,9981,9984,9990,9994,10007,10025,10038,10048,10056,10059,10063,10064,10074,10076,10089,10095,10106,10113,10117,10140,10153,10159,10161,10163,10166,10171,10177,10201,10212,10220,10222,10231,10232,10252,10254,10261,10268,10273,10288,10298,10306,10313,10329,10351,10352,10361,10375,10381,10403,10404,10411,10413,10422,10425,10429,10434,10435,10441,10447,10472,10475,10481,10482,10510,10511,10518,10520,10526,10542,10543,10558,10573,10581,10595,10628,10636,10640,10649,10670,10680,10689,10695,10703,10704,10723,10734,10738,10748,10752,10761,10766,10775,10788,10789,10799,10801,10808,10828,10838,10844,10848,10857,10885,10901,10917,10919,10941,10947,10958,10974,10978,10982,10984,11019,11020,11038,11039,11040,11044,11050,11053,11064,11066,11082,11094,11102,11113,11114,11115,11117,11132,11159,11170,11173,11179,11180,11196,11199,11215,11220,11245,11248,11255,11258,11260,11264,11272,11273,11293,11297,11304,11307,11310,11313,11316,11337,11343,11355,11358,11363,11389,11393,11416,11431,11433,11435,11444,11454,11462,11468,11469,11477,11498,11512,11519,11522,11540,11543,11555,11583,11584,11587,11591,11601,11603,11619,11631,11640,11647,11651,11653,11657,11663,11683,11686,11711,11739,11747,11752,11754,11764,11784,11815,11823,11827,11835,11862,11868,11874,11884,11888,11897,11905,11912,11918,11925,11946,11953,11991,11996,12015,12030,12036,12041,12056,12061,12072,12081,12121,12123,12133,12136,12180,12185,12188,12194,12229,12231,12240,12246,12252,12261,12278,12287,12308,12320,12330,12350,12351,12400,12405,12407,12425,12426,12431,12438,12451,12452,12453,12463,12468,12475,12479,12491,12524,12526,12527,12537,12544,12546,12560,12568,12572,12580,12599,12607,12647,12664,12666,12671,12685,12701,12704,12711,12727,12735,12741,12769,12773,12780,12787,12794,12798,12817,12832,12838,12841,12845,12846,12870,12881,12898,12916,12917,12922,12930,12931,12943,12948,12952,12959,12972,12983,12986,13009,13012,13014,13017,13022,13028,13071,13088,13138,13141,13147,13158,13160,13183,13189,13197,13207,13211,13219,13231,13240,13251,13254,13271,13272,13273,13280,13282,13294,13301,13306,13312,13325,13326,13328,13359,13371,13373,13397,13400,13403,13426,13431,13438,13450,13454,13457,13472,13475,13486,13489,13496,13507,13509,13513,13514,13519,13529,13543,13544,13550,13571,13581,13582,13587,13591,13609,13611,13627,13643,13646,13648,13652,13668,13669,13671,13675,13677,13680,13691,13692,13693,13695,13696,13698,13707,13714,13731,13739,13756,13761,13762,13772,13775,13811,13817,13820,13825,13826,13883,13885,13887,13891,13898,13928,13929,13934,13935,13959,13963,13968,13975,13983,13997,13999,14020,14022,14028,14033,14038,14066,14074,14080,14082,14084,14086,14090,14096,14104,14127,14142,14148,14159,14168,14180,14181,14184,14185,14189,14195,14198,14201,14204,14218,14221,14223,14225,14233,14243,14246,14249,14266,14268,14274,14291,14308,14312,14313,14315,14321,14333,14350,14352,14357,14400,14402,14404,14410,14411,14417,14418,14425,14439,14444,14460,14463,14467,14475,14477,14478,14489,14491,14528,14536,14540,14546,14553,14558,14570,14575,14597,14598,14602,14628,14630,14638,14668,14678,14694,14696,14704,14727,14751,14756,14758,14762,14767,14779,14781,14787,14793,14797,14801,14814,14815,14818,14835,14843,14845,14864,14891,14892,14901,14927,14944,14945,14953,14975,14976,14978,14981,14987,14991,15006,15008,15025,15035,15051,15058,15067,15079,15091,15094,15099,15102,15151,15154,15157,15159,15171,15175,15188,15204,15209,15227,15236,15244,15269,15275,15283,15299,15333,15336,15342,15346,15349,15353,15354,15356,15369,15382,15383,15394,15395,15404,15405,15408,15409,15410,15427,15428,15438,15459,15465,15469,15492,15500,15522,15551,15554,15559,15574,15576,15580,15587,15591,15614,15621,15627,15652,15671,15698,15727,15749,15751,15755,15776,15792,15807,15816,15824,15825,15828,15842,15847,15890,15897,15909,15922,15929,15941,15944,15949,15967,15969,15982,16007,16009,16032,16036,16038,16039,16042,16047,16050,16072,16080,16118,16126,16153,16163,16172,16173,16174,16177,16184,16206,16208,16232,16233,16240,16242,16244,16253,16256,16257,16261,16265,16279,16289,16293,16296,16299,16316,16319,16330,16340,16362,16368,16374,16379,16384,16392,16407,16422,16433,16438,16442,16444,16449,16463,16468,16477,16500,16506,16514,16536,16545,16560,16587,16588,16593,16601,16611,16613,16619,16624,16625,16627,16649,16663,16683,16685,16690,16697,16705,16707,16723,16741,16742,16751,16758,16775,16776,16785,16787,16788,16804,16813,16821,16846,16873,16877,16890,16915,16920,16921,16958,16970,16984,17000,17012,17020,17026,17042,17086,17093,17095,17110,17111,17118,17121,17141,17144,17169,17171,17184,17195,17198,17215,17224,17226,17237,17246,17254,17257,17267,17272,17275,17285,17287,17292,17319,17335,17368,17387,17389,17395,17396,17428,17440,17461,17469,17471,17474,17486,17500,17504,17510,17513,17536,17542,17562,17565,17569,17595,17596,17601,17606,17609,17610,17622,17629,17630,17631,17633,17641,17673,17683,17686,17688,17705,17709,17722,17727,17745,17746,17747,17770,17799,17826,17829,17843,17855,17857,17877,17895,17905,17909,17914,17918,17952,17954,17959,17975,17981,17982,17988,18029,18033,18038,18049,18063,18066,18089,18091,18100,18104,18107,18114,18124,18127,18128,18142,18173,18175,18199,18202,18204,18213,18215,18223,18226,18236,18237,18250,18257,18269,18270,18284,18291,18313,18325,18336,18349,18356,18358,18380,18382,18386,18389,18412,18414,18415,18435,18451,18459,18486,18490,18494,18498,18499,18502,18523,18524,18542,18547,18559,18564,18587,18593,18601,18616,18619,18627,18632
)
x.all_features[[4]] <-
c(
202,211,400,1222,2137,2170,2277,2364,2689,2882,3020,3045,3065,3283,3794,4215,4448,4473,4688,4924,5337,5498,5664,5779,5782,5967,6179,6564,6808,6854,6901,6948,6965,6999,7497,7665,7946,8013,8485,8671,8772,9149,9256,9319,9841,10152,10385,10415,10631,10882,11053,11332,11511,11783,12186,12247,12270,12536,12639,12956,13434,13520,13723,13772,13804,14173,14649,14724,15094,15357,15701,16076,16211,16229,16649,16721,17181,17428,17635,18207,18211,18263,18561,18596
)
x.all_features[[5]] <-
c(
10,11,13,32,52,67,74,83,144,240,252,257,299,327,364,409,470,525,530,640,765,779,812,840,904,1012,1013,1025,1054,1084,1086,1087,1107,1117,1134,1174,1213,1243,1345,1403,1487,1509,1571,1602,1608,1639,1640,1662,1692,1700,1723,1724,1730,1820,1875,1884,1925,1940,2011,2078,2136,2149,2168,2186,2297,2336,2379,2562,2635,2646,2648,2657,2659,2854,3070,3076,3138,3161,3200,3242,3278,3331,3353,3418,3521,3527,3551,3581,3595,3604,3651,3663,3735,3750,3785,3821,3830,3835,3928,4017,4087,4092,4145,4186,4388,4425,4481,4505,4639,4744,4756,4765,4782,4890,4982,5036,5153,5258,5301,5308,5356,5372,5383,5439,5449,5552,5585,5616,5638,5723,5789,5797,5821,6000,6010,6019,6029,6056,6097,6146,6198,6205,6214,6218,6225,6290,6317,6336,6339,6342,6575,6592,6613,6617,6644,6657,6661,6802,6980,7078,7138,7139,7142,7168,7185,7192,7257,7282,7287,7332,7413,7435,7477,7513,7569,7649,7697,7719,7728,7730,7731,7768,7856,7888,7958,7961,7974,8025,8054,8058,8081,8193,8262,8264,8279,8323,8333,8354,8359,8402,8526,8555,8592,8623,8657,8881,8910,8923,8963,8968,9008,9012,9091,9131,9167,9231,9262,9286,9292,9353,9406,9408,9446,9487,9506,9549,9564,9578,9624,9660,9666,9763,9821,9925,9993,10038,10085,10094,10153,10162,10181,10366,10416,10424,10428,10467,10475,10485,10495,10555,10639,10654,10685,10737,10758,10775,10799,10849,10895,11068,11151,11168,11226,11264,11303,11305,11420,11435,11452,11512,11552,11613,11631,11663,11711,11897,11927,12066,12109,12136,12198,12252,12281,12287,12311,12314,12337,12390,12403,12479,12546,12638,12647,12680,12704,12725,12729,12769,12796,12823,12838,12844,12864,12917,12924,12948,12983,12986,12995,13071,13165,13195,13294,13301,13306,13312,13326,13432,13579,13580,13611,13629,13652,13669,13670,13675,13714,13761,13803,13859,13885,13891,13902,13926,13942,13975,13984,13987,13997,14027,14080,14090,14104,14105,14127,14132,14168,14180,14195,14225,14255,14263,14312,14362,14377,14444,14473,14476,14538,14555,14575,14595,14637,14646,14662,14696,14708,14749,14842,14944,14953,14981,15031,15068,15070,15145,15188,15233,15260,15288,15299,15354,15361,15374,15395,15403,15404,15408,15410,15428,15430,15439,15533,15545,15560,15563,15587,15627,15698,15722,15755,15807,15897,15949,15990,16118,16163,16184,16190,16196,16224,16253,16267,16284,16301,16305,16333,16339,16341,16407,16460,16569,16607,16613,16627,16682,16770,16776,16857,17005,17026,17086,17095,17118,17120,17169,17179,17237,17238,17278,17341,17359,17411,17461,17484,17522,17523,17552,17562,17614,17622,17631,17653,17688,17709,17716,17727,17747,17766,17767,17807,17843,17905,17913,17928,17945,18006,18066,18067,18093,18094,18105,18128,18142,18176,18194,18221,18225,18227,18266,18270,18342,18373,18386,18389,18416,18426,18456,18471,18486,18545,18547,18559,18615
)
x.all_features[[6]] <-
c(
5,10,11,14,37,74,112,150,163,188,189,193,217,236,237,244,250,252,298,306,330,336,366,377,396,420,429,469,507,513,540,606,638,640,675,707,747,759,793,801,829,840,870,944,953,956,972,1013,1019,1034,1039,1057,1086,1087,1090,1117,1123,1134,1141,1158,1162,1169,1186,1193,1201,1220,1230,1243,1257,1269,1289,1334,1345,1354,1433,1448,1451,1487,1532,1534,1560,1572,1600,1608,1632,1639,1640,1642,1662,1762,1766,1769,1786,1793,1802,1830,1850,1870,1910,1926,1944,1952,1968,1973,2005,2036,2061,2070,2076,2086,2103,2142,2144,2156,2163,2221,2299,2324,2342,2359,2363,2367,2377,2414,2415,2422,2440,2445,2462,2476,2519,2539,2542,2555,2561,2614,2654,2655,2657,2665,2705,2708,2719,2724,2744,2752,2766,2769,2792,2811,2827,2832,2838,2849,2894,2911,2913,2959,2988,3005,3007,3014,3034,3063,3078,3081,3094,3109,3204,3222,3229,3255,3291,3346,3353,3401,3404,3409,3449,3454,3459,3461,3477,3487,3510,3528,3536,3565,3581,3604,3650,3651,3653,3659,3674,3683,3685,3693,3701,3714,3739,3746,3784,3793,3825,3830,3856,3897,3900,3906,3930,4003,4125,4183,4185,4212,4214,4220,4233,4236,4274,4315,4324,4329,4342,4487,4488,4494,4497,4537,4583,4586,4587,4590,4597,4608,4635,4700,4702,4712,4724,4742,4743,4744,4756,4766,4795,4804,4870,4876,4884,4887,4900,4923,4929,4965,4974,5038,5069,5090,5091,5094,5101,5115,5142,5158,5165,5221,5256,5269,5343,5373,5375,5383,5467,5516,5533,5535,5564,5578,5607,5648,5650,5667,5669,5682,5689,5699,5718,5723,5751,5756,5764,5785,5797,5821,5832,5850,5856,5881,5883,5891,5900,5928,5974,5977,6009,6010,6022,6052,6061,6066,6081,6097,6098,6169,6198,6217,6225,6244,6290,6299,6329,6334,6349,6384,6407,6408,6414,6452,6503,6575,6579,6583,6613,6622,6642,6644,6658,6659,6669,6683,6730,6755,6814,6837,6850,6870,6880,6909,6912,6993,7035,7040,7055,7106,7113,7120,7136,7173,7182,7185,7202,7203,7237,7259,7275,7282,7293,7320,7326,7330,7381,7387,7402,7466,7503,7511,7513,7560,7568,7569,7580,7582,7584,7593,7597,7623,7625,7681,7682,7688,7695,7714,7722,7730,7733,7785,7793,7811,7820,7829,7851,7861,7863,7872,7891,7892,7911,7932,7933,7946,7961,7971,7981,7982,8019,8048,8049,8085,8097,8124,8163,8191,8199,8226,8237,8238,8281,8294,8307,8333,8368,8371,8383,8389,8394,8500,8518,8530,8592,8618,8640,8644,8663,8679,8703,8719,8797,8814,8857,8867,8902,8906,8918,8940,8945,8951,8960,8982,9008,9023,9070,9073,9091,9100,9117,9118,9158,9189,9196,9230,9239,9243,9246,9257,9284,9292,9303,9329,9344,9353,9354,9357,9368,9381,9397,9402,9414,9423,9445,9462,9479,9506,9518,9530,9548,9562,9568,9578,9593,9611,9643,9660,9661,9706,9760,9763,9799,9822,9842,9843,9850,9865,9899,9939,9950,9994,10019,10025,10038,10039,10048,10056,10058,10084,10166,10180,10220,10228,10268,10278,10280,10375,10411,10434,10437,10467,10492,10524,10538,10554,10573,10614,10621,10632,10640,10662,10674,10683,10695,10749,10771,10775,10789,10808,10811,10815,10832,10840,10880,10884,10902,11030,11040,11068,11086,11092,11094,11114,11173,11199,11236,11245,11252,11258,11260,11264,11271,11313,11329,11338,11417,11422,11433,11438,11450,11452,11481,11501,11514,11522,11539,11558,11562,11572,11591,11613,11623,11624,11647,11659,11666,11667,11710,11711,11734,11743,11749,11769,11771,11786,11835,11863,11868,11888,11903,11905,11910,11992,12036,12040,12047,12056,12066,12073,12093,12109,12121,12123,12128,12129,12134,12149,12154,12155,12173,12193,12235,12237,12252,12312,12336,12337,12351,12398,12408,12494,12516,12537,12546,12554,12560,12572,12592,12605,12638,12649,12660,12693,12725,12735,12737,12757,12781,12872,12876,12898,12950,12953,12959,12976,12977,12986,12992,13014,13041,13057,13078,13121,13130,13141,13146,13165,13169,13180,13188,13211,13282,13331,13340,13386,13413,13418,13496,13509,13519,13523,13537,13543,13564,13571,13613,13617,13627,13630,13639,13644,13652,13654,13671,13680,13687,13706,13707,13724,13737,13739,13761,13764,13775,13803,13817,13820,13835,13838,13861,13885,13898,13908,13918,13983,13985,13987,13997,13998,14001,14004,14026,14028,14031,14047,14091,14100,14104,14127,14167,14185,14195,14196,14208,14209,14221,14233,14268,14275,14278,14309,14312,14362,14449,14464,14468,14473,14553,14580,14619,14678,14704,14727,14797,14801,14814,14829,14864,14865,14896,14901,14916,14917,14923,14924,14927,14949,14958,14959,14981,15023,15038,15070,15111,15118,15122,15132,15157,15161,15171,15188,15209,15215,15231,15244,15299,15334,15353,15354,15359,15395,15410,15428,15430,15438,15522,15533,15566,15570,15576,15594,15606,15620,15627,15668,15698,15722,15729,15798,15807,15832,15852,15870,15875,15909,15924,15944,15949,15955,16021,16149,16176,16184,16186,16207,16225,16284,16319,16374,16411,16416,16421,16466,16500,16521,16561,16569,16584,16587,16606,16635,16641,16669,16673,16690,16695,16705,16710,16742,16770,16787,16824,16830,16869,16871,16915,16935,17027,17086,17102,17110,17111,17117,17141,17175,17187,17194,17195,17226,17237,17238,17254,17275,17278,17280,17285,17287,17292,17321,17359,17390,17404,17411,17434,17436,17453,17484,17486,17488,17500,17506,17513,17517,17532,17534,17552,17586,17606,17619,17630,17631,17653,17668,17669,17684,17713,17723,17733,17746,17747,17749,17767,17806,17816,17821,17822,17829,17859,17885,17905,17913,17923,17983,18027,18058,18084,18106,18115,18142,18144,18179,18213,18226,18235,18241,18250,18270,18275,18284,18311,18344,18364,18382,18385,18386,18389,18397,18414,18470,18471,18472,18480,18491,18498,18501,18507,18519,18558,18579,18581,18593,18624,18635
)
x.all_features[[7]] <-
c(
34,42,44,71,72,177,190,227,275,297,310,325,335,337,346,353,379,386,391,412,476,497,510,569,580,621,643,670,691,692,715,719,763,769,810,836,867,869,874,875,900,907,922,959,968,985,993,1072,1095,1108,1110,1129,1188,1203,1234,1247,1262,1292,1321,1336,1339,1385,1400,1460,1462,1494,1513,1551,1575,1660,1667,1668,1689,1690,1696,1725,1771,1780,1791,1808,1818,1857,1873,1877,1911,1921,1951,1953,1955,1957,1987,1997,2002,2008,2040,2051,2068,2099,2108,2180,2210,2222,2229,2252,2281,2406,2413,2443,2461,2481,2525,2556,2558,2571,2572,2583,2588,2604,2605,2606,2629,2632,2664,2687,2693,2695,2704,2716,2741,2777,2779,2798,2801,2843,2851,2878,2956,2968,2974,3004,3011,3012,3024,3039,3040,3053,3059,3077,3095,3098,3131,3139,3150,3177,3210,3251,3308,3313,3337,3389,3439,3491,3535,3556,3576,3703,3708,3742,3743,3772,3776,3786,3797,3812,3820,3822,3843,3854,3873,3886,3912,3922,3962,3972,3983,4050,4117,4141,4147,4169,4190,4192,4205,4227,4247,4249,4259,4261,4377,4404,4461,4554,4562,4582,4600,4617,4631,4648,4649,4659,4676,4704,4715,4729,4788,4815,4847,4891,4895,4898,4899,4934,4991,4999,5084,5123,5168,5181,5283,5301,5305,5346,5384,5461,5472,5474,5499,5505,5555,5561,5567,5577,5597,5611,5618,5640,5644,5679,5690,5698,5725,5746,5769,5781,5809,5846,5853,5873,5875,6029,6070,6150,6261,6307,6309,6344,6352,6388,6427,6486,6500,6542,6553,6573,6679,6688,6752,6764,6785,6793,6845,6851,6852,6856,6861,6867,6878,6892,6899,6990,7023,7071,7084,7086,7111,7123,7139,7170,7205,7272,7297,7331,7364,7372,7377,7394,7431,7475,7482,7491,7518,7558,7562,7566,7576,7607,7641,7720,7783,7802,7841,7852,7884,7899,7903,7937,7941,7983,7988,7999,8003,8042,8071,8090,8118,8131,8140,8154,8159,8167,8257,8265,8346,8411,8432,8442,8446,8499,8548,8571,8599,8608,8623,8645,8676,8687,8698,8750,8800,8895,8925,8950,8955,9031,9033,9128,9129,9210,9260,9328,9391,9395,9456,9489,9503,9510,9522,9610,9655,9674,9686,9716,9724,9765,9772,9789,9793,9798,9805,9806,9834,9878,9880,9894,9903,9925,9959,9963,9976,9987,9990,10011,10024,10031,10106,10130,10159,10194,10211,10247,10296,10380,10383,10440,10520,10531,10572,10580,10601,10617,10642,10650,10664,10726,10765,10848,10851,10854,10872,10885,10899,10900,10922,10927,10941,10956,11075,11095,11102,11106,11119,11139,11142,11149,11150,11158,11170,11174,11192,11194,11215,11232,11237,11247,11255,11279,11290,11325,11336,11384,11407,11408,11434,11457,11459,11461,11488,11495,11548,11555,11579,11583,11653,11688,11724,11744,11748,11789,11801,11847,11886,11935,11981,11984,12021,12054,12061,12092,12117,12156,12187,12195,12204,12212,12222,12260,12272,12316,12325,12361,12384,12415,12466,12527,12539,12544,12566,12598,12601,12619,12672,12684,12711,12759,12782,12797,12800,12871,12923,12924,12939,12961,12964,12975,12993,13002,13009,13017,13036,13076,13084,13085,13097,13117,13152,13160,13179,13226,13265,13276,13280,13362,13397,13410,13426,13460,13468,13482,13485,13514,13524,13539,13574,13585,13605,13609,13626,13642,13649,13686,13826,13879,13889,13892,13976,13978,13996,14008,14021,14043,14053,14054,14058,14066,14070,14087,14113,14131,14137,14156,14161,14235,14282,14286,14304,14348,14357,14363,14369,14373,14374,14382,14419,14425,14430,14437,14455,14487,14489,14504,14517,14576,14600,14614,14620,14625,14655,14669,14719,14740,14877,14878,14911,14922,14935,14956,14983,14993,15028,15074,15077,15113,15146,15168,15219,15247,15287,15288,15294,15372,15388,15462,15476,15491,15540,15548,15568,15625,15635,15689,15703,15779,15790,15816,15824,15828,15844,15847,15878,15895,15912,15989,16013,16057,16141,16173,16213,16238,16239,16242,16249,16277,16289,16326,16379,16444,16470,16485,16487,16493,16503,16555,16623,16638,16661,16697,16731,16744,16750,16759,16761,16769,16771,16773,16776,16811,16826,16836,16887,16909,17000,17020,17031,17108,17123,17172,17174,17211,17233,17236,17248,17259,17262,17272,17348,17423,17441,17470,17515,17536,17551,17564,17566,17590,17596,17608,17632,17641,17667,17677,17753,17788,17843,17878,17951,17952,17959,17973,18000,18075,18124,18147,18158,18174,18186,18191,18204,18254,18262,18327,18356,18429,18513,18532,18540,18551,18588,18605,18610,18616
)
x.all_features[[8]] <-
c(
20,21,27,28,32,34,42,44,46,56,71,72,85,99,114,132,145,146,168,180,183,187,193,199,205,233,246,255,262,268,277,283,286,287,293,296,310,311,334,335,337,344,359,363,373,376,379,386,391,414,425,444,448,451,462,499,512,519,533,543,567,582,591,615,632,651,656,659,667,683,692,703,719,725,738,743,750,758,760,775,791,799,800,805,818,831,836,845,867,868,879,890,891,898,901,908,909,924,926,938,948,955,959,960,968,982,992,993,994,1001,1007,1012,1018,1026,1028,1053,1055,1061,1064,1065,1066,1069,1072,1109,1110,1112,1140,1148,1155,1158,1170,1173,1188,1195,1200,1216,1234,1262,1276,1278,1291,1297,1301,1302,1305,1314,1319,1320,1321,1339,1351,1360,1361,1362,1363,1364,1392,1394,1400,1415,1425,1426,1435,1445,1446,1452,1460,1462,1480,1483,1488,1494,1505,1508,1518,1531,1538,1554,1581,1583,1584,1598,1636,1652,1653,1663,1667,1668,1672,1681,1693,1698,1701,1714,1726,1734,1736,1759,1761,1770,1771,1791,1806,1817,1818,1823,1837,1840,1846,1848,1857,1867,1868,1875,1876,1877,1880,1889,1893,1899,1900,1914,1933,1935,1939,1943,1951,1953,1955,1957,1971,1991,1992,1994,1997,2007,2008,2018,2038,2040,2043,2048,2051,2055,2059,2062,2079,2080,2082,2099,2100,2101,2102,2107,2111,2112,2164,2189,2190,2200,2205,2207,2209,2210,2214,2223,2229,2252,2255,2257,2258,2259,2264,2272,2286,2300,2319,2325,2326,2365,2376,2386,2388,2391,2401,2402,2425,2443,2446,2461,2466,2475,2481,2485,2489,2505,2506,2518,2548,2558,2571,2576,2583,2586,2592,2594,2598,2599,2603,2608,2627,2629,2632,2640,2642,2643,2666,2686,2691,2695,2696,2700,2701,2711,2713,2725,2726,2732,2741,2742,2757,2775,2777,2798,2799,2803,2805,2807,2810,2826,2836,2841,2852,2857,2860,2864,2865,2868,2878,2898,2914,2928,2940,2943,2945,2964,2965,2973,2974,2980,2985,2987,2997,3017,3022,3025,3048,3062,3070,3077,3107,3112,3122,3131,3139,3150,3164,3165,3177,3181,3197,3209,3216,3220,3241,3256,3263,3279,3288,3296,3308,3313,3317,3325,3334,3352,3363,3368,3369,3381,3389,3392,3400,3425,3436,3444,3445,3458,3469,3491,3504,3535,3537,3542,3556,3558,3560,3569,3576,3582,3586,3599,3614,3620,3622,3642,3643,3656,3661,3663,3664,3667,3687,3726,3736,3738,3741,3742,3743,3747,3751,3771,3777,3786,3790,3801,3805,3822,3840,3843,3844,3854,3864,3868,3885,3887,3896,3914,3921,3933,3943,3944,3951,3962,3963,3977,3984,3991,3993,4010,4020,4022,4030,4046,4050,4068,4072,4084,4094,4106,4108,4115,4124,4144,4152,4159,4167,4169,4182,4190,4196,4205,4211,4218,4222,4224,4230,4240,4242,4243,4247,4248,4249,4250,4259,4268,4277,4290,4293,4295,4296,4302,4307,4319,4334,4341,4349,4362,4372,4382,4400,4419,4422,4447,4476,4496,4519,4532,4536,4549,4582,4589,4616,4621,4632,4637,4638,4649,4651,4652,4659,4681,4699,4710,4715,4718,4734,4747,4758,4760,4772,4789,4802,4808,4815,4816,4829,4843,4847,4849,4855,4872,4891,4899,4900,4903,4916,4920,4934,4964,4969,4979,4989,4993,4999,5000,5001,5019,5020,5022,5029,5035,5040,5043,5065,5076,5084,5096,5128,5137,5143,5147,5159,5168,5177,5198,5199,5208,5211,5212,5248,5272,5274,5283,5284,5285,5294,5305,5314,5324,5333,5336,5350,5355,5358,5359,5362,5363,5364,5368,5373,5384,5412,5414,5435,5442,5461,5462,5472,5474,5483,5490,5493,5494,5498,5499,5500,5503,5507,5515,5521,5555,5559,5565,5566,5567,5576,5582,5584,5595,5597,5617,5618,5627,5630,5644,5660,5664,5666,5670,5679,5681,5686,5690,5692,5700,5712,5713,5724,5732,5771,5787,5790,5796,5799,5804,5805,5809,5810,5826,5827,5829,5853,5854,5860,5873,5874,5875,5878,5879,5885,5888,5890,5893,5908,5915,5916,5919,5931,5935,5950,5979,5985,6045,6055,6064,6068,6072,6086,6106,6107,6118,6139,6147,6150,6153,6166,6183,6185,6191,6215,6233,6238,6255,6276,6301,6335,6352,6362,6363,6376,6378,6379,6384,6396,6404,6406,6412,6413,6424,6427,6430,6439,6442,6458,6476,6480,6482,6499,6500,6509,6512,6536,6543,6550,6553,6559,6565,6566,6568,6578,6581,6589,6590,6603,6604,6616,6619,6640,6665,6671,6679,6688,6696,6700,6732,6734,6737,6746,6747,6751,6752,6766,6769,6786,6798,6813,6830,6845,6853,6860,6861,6878,6892,6899,6915,6920,6921,6977,6981,6987,6990,7013,7021,7022,7023,7026,7033,7036,7039,7043,7061,7064,7069,7071,7084,7090,7095,7098,7119,7140,7158,7181,7199,7205,7208,7210,7215,7226,7229,7267,7270,7298,7308,7320,7322,7324,7327,7342,7343,7355,7377,7390,7394,7404,7412,7418,7421,7437,7445,7447,7457,7458,7471,7473,7475,7480,7491,7493,7529,7534,7538,7542,7550,7552,7554,7562,7571,7574,7595,7602,7608,7609,7616,7622,7636,7641,7652,7683,7693,7694,7702,7709,7710,7717,7721,7751,7760,7772,7773,7776,7777,7779,7781,7783,7823,7827,7831,7837,7841,7849,7852,7858,7865,7871,7884,7887,7899,7918,7919,7920,7921,7984,7988,7996,8003,8007,8035,8044,8045,8057,8061,8067,8072,8083,8084,8090,8104,8106,8111,8118,8126,8131,8144,8153,8167,8205,8210,8213,8223,8227,8236,8245,8246,8248,8286,8293,8295,8299,8305,8334,8340,8343,8367,8371,8384,8388,8395,8397,8417,8440,8441,8445,8455,8461,8462,8464,8466,8480,8494,8495,8497,8499,8511,8512,8527,8545,8551,8559,8562,8566,8571,8574,8576,8580,8584,8593,8594,8597,8602,8612,8613,8624,8631,8639,8646,8669,8674,8682,8692,8695,8723,8738,8746,8747,8749,8750,8756,8758,8780,8785,8787,8796,8802,8808,8810,8822,8842,8858,8863,8868,8872,8874,8877,8879,8905,8908,8912,8913,8920,8925,8928,8931,8981,8993,8999,9004,9011,9015,9027,9034,9040,9047,9050,9056,9064,9084,9115,9125,9129,9170,9173,9178,9194,9217,9218,9227,9228,9242,9266,9271,9311,9322,9328,9337,9348,9366,9375,9384,9395,9436,9443,9454,9484,9495,9511,9514,9536,9540,9545,9554,9577,9583,9601,9606,9610,9612,9613,9617,9623,9629,9646,9650,9651,9663,9669,9673,9683,9686,9690,9700,9701,9703,9721,9723,9737,9738,9748,9765,9767,9787,9788,9789,9801,9807,9812,9815,9823,9868,9878,9885,9889,9894,9903,9908,9909,9911,9922,9925,9926,9929,9931,9959,9962,9965,9967,9975,9976,9977,9980,9984,9986,10006,10031,10044,10063,10106,10108,10122,10126,10130,10143,10148,10150,10159,10161,10171,10182,10194,10196,10213,10221,10222,10238,10247,10250,10263,10277,10293,10299,10304,10306,10328,10351,10357,10365,10371,10375,10380,10395,10397,10401,10408,10418,10420,10425,10427,10433,10436,10444,10447,10449,10456,10472,10489,10497,10500,10520,10526,10534,10544,10546,10553,10556,10561,10574,10575,10580,10586,10593,10601,10606,10610,10618,10620,10628,10634,10636,10645,10663,10686,10690,10703,10717,10720,10724,10748,10750,10759,10765,10772,10773,10788,10797,10801,10804,10806,10807,10822,10823,10838,10847,10851,10861,10864,10870,10878,10886,10892,10896,10899,10908,10919,10922,10927,10938,10963,10978,10982,10984,10994,11005,11013,11029,11042,11052,11059,11061,11063,11066,11071,11078,11082,11101,11102,11106,11111,11118,11119,11120,11128,11133,11142,11148,11167,11172,11183,11184,11186,11192,11194,11209,11212,11215,11217,11234,11235,11237,11242,11247,11248,11251,11255,11278,11279,11285,11289,11308,11310,11316,11319,11333,11336,11343,11349,11365,11371,11383,11385,11393,11424,11431,11434,11442,11448,11459,11469,11479,11480,11488,11498,11523,11534,11537,11540,11541,11543,11546,11554,11555,11583,11601,11606,11615,11617,11622,11634,11653,11665,11683,11693,11702,11712,11718,11724,11732,11744,11751,11752,11764,11765,11766,11768,11781,11788,11796,11809,11815,11821,11823,11838,11844,11846,11847,11861,11864,11877,11879,11884,11898,11899,11912,11915,11929,11930,11936,11943,11968,11975,11977,11991,12014,12021,12030,12046,12054,12061,12100,12106,12130,12136,12153,12180,12181,12191,12214,12239,12240,12257,12258,12260,12261,12274,12278,12316,12325,12338,12361,12364,12374,12393,12397,12400,12411,12415,12431,12448,12450,12460,12479,12495,12499,12502,12507,12509,12527,12535,12539,12544,12558,12559,12585,12607,12614,12619,12623,12625,12642,12647,12664,12671,12673,12684,12691,12700,12701,12704,12705,12711,12744,12750,12755,12771,12773,12780,12783,12800,12810,12822,12824,12830,12831,12832,12835,12845,12855,12857,12871,12874,12884,12915,12922,12925,12937,12939,12963,12964,12975,12980,12991,13002,13007,13009,13011,13012,13017,13021,13062,13063,13077,13108,13120,13129,13139,13152,13153,13155,13160,13168,13171,13175,13178,13179,13204,13207,13208,13219,13221,13226,13239,13245,13246,13247,13251,13257,13259,13265,13269,13270,13271,13272,13280,13287,13295,13301,13322,13325,13334,13345,13346,13349,13368,13371,13372,13373,13375,13379,13392,13397,13407,13410,13419,13422,13426,13431,13457,13463,13465,13466,13467,13468,13472,13483,13488,13500,13512,13513,13514,13518,13531,13538,13539,13551,13554,13555,13566,13568,13574,13587,13588,13601,13609,13624,13633,13646,13649,13658,13666,13667,13685,13690,13691,13693,13696,13702,13708,13710,13718,13735,13736,13739,13762,13772,13802,13826,13840,13868,13869,13872,13876,13880,13883,13901,13910,13911,13933,13934,13935,13946,13959,13974,13976,13979,13980,13996,14000,14006,14007,14008,14011,14015,14033,14037,14054,14066,14074,14077,14087,14114,14117,14139,14146,14153,14159,14161,14188,14192,14207,14218,14238,14243,14248,14273,14277,14286,14287,14293,14294,14303,14308,14313,14318,14320,14321,14323,14346,14357,14360,14372,14375,14390,14392,14394,14400,14410,14411,14412,14413,14419,14425,14430,14445,14452,14463,14469,14491,14504,14509,14536,14540,14541,14546,14558,14592,14597,14600,14605,14617,14618,14620,14625,14647,14655,14666,14695,14697,14698,14734,14737,14740,14748,14751,14759,14783,14793,14794,14809,14815,14838,14847,14851,14879,14880,14911,14912,14922,14931,14932,14944,14952,14973,14976,14978,14984,14997,15004,15008,15015,15025,15044,15047,15064,15066,15067,15079,15080,15082,15084,15092,15101,15109,15121,15133,15139,15142,15146,15166,15169,15175,15202,15204,15237,15257,15261,15262,15264,15265,15273,15279,15285,15288,15297,15327,15388,15400,15405,15409,15417,15452,15469,15476,15510,15514,15535,15538,15540,15555,15556,15557,15565,15571,15582,15587,15590,15611,15614,15625,15648,15651,15653,15670,15671,15674,15680,15689,15703,15717,15727,15739,15763,15773,15783,15790,15792,15793,15804,15809,15824,15827,15833,15834,15835,15838,15844,15847,15848,15851,15866,15872,15876,15889,15891,15896,15925,15941,15952,15968,15969,15970,15985,16007,16008,16031,16037,16038,16047,16050,16054,16070,16071,16074,16078,16081,16129,16134,16140,16154,16155,16165,16173,16174,16180,16206,16208,16209,16213,16218,16236,16238,16247,16249,16250,16252,16253,16261,16262,16265,16330,16337,16345,16369,16370,16375,16377,16379,16385,16389,16391,16393,16399,16414,16434,16436,16444,16445,16456,16457,16458,16463,16468,16472,16476,16480,16481,16483,16484,16488,16499,16503,16506,16527,16537,16538,16541,16545,16546,16547,16577,16581,16583,16589,16591,16593,16630,16653,16680,16682,16692,16696,16697,16700,16712,16731,16743,16744,16745,16751,16762,16766,16772,16777,16791,16793,16795,16803,16813,16817,16821,16829,16834,16849,16861,16870,16876,16877,16879,16900,16924,16941,16946,16955,16958,16961,16962,16967,17011,17030,17034,17042,17044,17065,17067,17070,17071,17075,17078,17099,17108,17109,17121,17124,17130,17137,17144,17161,17172,17191,17200,17224,17231,17233,17250,17256,17257,17260,17263,17269,17271,17293,17303,17308,17323,17325,17330,17335,17346,17354,17357,17368,17369,17388,17396,17416,17423,17428,17433,17437,17462,17464,17465,17468,17470,17519,17521,17527,17530,17536,17539,17541,17550,17577,17590,17596,17600,17609,17626,17641,17660,17676,17678,17679,17682,17683,17698,17699,17700,17706,17707,17708,17711,17730,17734,17753,17754,17756,17769,17770,17780,17793,17795,17799,17824,17826,17857,17860,17861,17889,17893,17909,17916,17919,17927,17934,17939,17945,17949,17951,17955,17959,17961,17965,17970,17971,17975,17976,17977,17994,18000,18002,18014,18019,18029,18080,18091,18095,18101,18120,18124,18158,18168,18173,18175,18176,18186,18199,18204,18206,18212,18214,18232,18233,18236,18252,18271,18285,18295,18303,18305,18312,18314,18327,18335,18336,18349,18356,18368,18380,18381,18405,18412,18415,18420,18429,18442,18456,18459,18469,18476,18488,18489,18494,18523,18540,18542,18547,18559,18566,18576,18585,18603,18616,18623,18627,18636
)
x.all_features[[9]] <-
c(
7,21,71,99,167,183,186,322,484,615,644,659,715,762,779,788,800,825,867,980,982,993,1016,1027,1029,1059,1130,1164,1245,1277,1292,1299,1423,1439,1446,1463,1488,1508,1512,1518,1575,1591,1609,1630,1645,1725,1747,1752,1777,1896,1921,1934,1990,1993,2097,2108,2229,2344,2364,2391,2435,2447,2572,2579,2695,2718,2804,2819,2823,2856,2888,2901,2929,2958,2965,2989,3004,3070,3110,3128,3210,3266,3288,3334,3403,3432,3467,3476,3484,3569,3583,3584,3589,3692,3725,3737,3828,3873,3885,3948,3963,4035,4082,4159,4219,4246,4247,4303,4351,4411,4454,4539,4561,4623,4699,4722,4745,5047,5063,5084,5167,5185,5211,5230,5266,5355,5432,5499,5500,5546,5649,5684,5688,5700,5711,5729,5975,6008,6055,6063,6076,6154,6215,6245,6307,6313,6351,6388,6404,6411,6474,6486,6499,6531,6539,6541,6586,6614,6639,6662,6692,6694,6776,6828,6851,6858,6861,6881,6892,6945,6965,6967,6989,7013,7018,7021,7039,7119,7142,7143,7147,7194,7236,7245,7261,7318,7370,7425,7444,7456,7491,7497,7532,7538,7599,7661,7717,7734,7753,7766,7770,7777,7783,7835,7841,7855,7913,7930,7939,7942,8003,8021,8034,8068,8123,8144,8150,8182,8198,8214,8236,8241,8311,8347,8466,8467,8485,8536,8548,8559,8673,8695,8720,8750,8758,8759,8772,8829,8849,8874,8887,8893,8896,8998,9006,9089,9103,9114,9143,9170,9216,9302,9369,9476,9542,9627,9634,9645,9696,9724,9731,9834,9861,9949,10024,10049,10083,10307,10333,10337,10356,10378,10380,10385,10394,10458,10478,10561,10565,10601,10633,10719,10725,10778,10797,10803,10823,10824,10848,10871,10904,10924,10932,10949,10956,10986,11081,11128,11143,11184,11194,11214,11232,11237,11305,11322,11335,11336,11442,11526,11534,11541,11582,11588,11670,11683,11724,11744,11761,11775,11787,11804,11851,11893,11898,11969,12014,12017,12021,12144,12192,12206,12247,12260,12306,12406,12461,12518,12594,12665,12667,12690,12694,12700,12720,12783,12914,13002,13007,13009,13076,13080,13099,13131,13277,13295,13302,13335,13343,13482,13500,13594,13620,13693,13708,13736,13744,13840,13979,13996,14003,14012,14053,14130,14227,14282,14318,14327,14355,14385,14396,14423,14430,14447,14460,14487,14621,14625,14645,14649,14692,14703,14716,14771,14782,14878,14992,15007,15032,15039,15044,15136,15139,15158,15167,15212,15322,15341,15388,15453,15476,15556,15568,15577,15625,15640,15643,15662,15734,15757,15824,15835,15840,15952,16012,16027,16093,16121,16127,16211,16213,16219,16230,16236,16275,16365,16404,16428,16474,16476,16493,16503,16526,16537,16543,16559,16571,16572,16585,16620,16631,16654,16666,16697,16731,16766,16781,16816,16860,16863,16912,16996,17020,17029,17056,17122,17132,17137,17159,17172,17252,17255,17260,17291,17328,17330,17409,17414,17467,17561,17592,17637,17647,17656,17676,17742,17755,17785,17920,17971,17978,18000,18149,18159,18174,18177,18195,18211,18263,18374,18392,18404,18425,18450,18459,18489,18551,18567
)
x.all_features[[10]] <-
c(
22,30,51,164,167,237,264,315,369,418,436,539,540,623,723,736,749,759,768,770,783,793,803,829,832,856,872,916,999,1038,1047,1076,1121,1141,1171,1190,1191,1201,1205,1257,1343,1478,1479,1523,1540,1559,1706,1708,1727,1744,1750,1841,2009,2029,2034,2041,2063,2143,2163,2248,2256,2273,2306,2307,2311,2350,2362,2396,2445,2498,2555,2578,2615,2619,2678,2785,2811,2824,2825,2827,2828,2882,2921,2935,2984,3000,3137,3145,3169,3190,3205,3222,3224,3240,3300,3364,3433,3455,3494,3508,3550,3581,3585,3588,3604,3651,3689,3698,3725,3815,3824,3877,3924,3929,3930,4038,4109,4221,4266,4298,4359,4386,4448,4473,4497,4500,4526,4570,4596,4597,4608,4620,4622,4684,4687,4730,4731,4738,4744,4756,4814,4825,4838,4885,4994,5012,5049,5081,5089,5101,5105,5127,5165,5186,5187,5195,5262,5289,5327,5437,5514,5534,5544,5556,5568,5569,5586,5674,5689,5719,5741,5776,5789,5792,5865,5869,5881,5897,5917,5927,5972,6009,6022,6046,6053,6062,6074,6105,6177,6217,6253,6280,6329,6374,6390,6407,6443,6471,6494,6577,6580,6608,6611,6629,6673,6681,6754,6761,6808,6910,6962,7040,7051,7136,7166,7171,7175,7195,7237,7246,7263,7268,7296,7326,7391,7395,7399,7442,7488,7495,7512,7546,7584,7594,7604,7635,7671,7677,7681,7686,7789,7805,7853,7854,7870,7931,7945,7946,7957,7966,7989,8018,8027,8032,8040,8120,8155,8296,8344,8345,8368,8412,8431,8508,8518,8530,8535,8556,8592,8677,8681,8710,8748,8766,8771,8784,8786,8857,8864,8871,8902,8903,8907,8929,8983,9010,9023,9037,9055,9070,9082,9120,9156,9189,9238,9268,9286,9352,9354,9363,9423,9605,9630,9640,9671,9675,9728,9752,9760,9771,9874,9964,9994,9995,10076,10092,10112,10116,10184,10189,10243,10244,10329,10416,10594,10614,10619,10649,10699,10785,10865,10915,10939,11037,11038,11067,11073,11182,11230,11260,11314,11317,11338,11339,11411,11475,11514,11524,11542,11561,11633,11673,11699,11786,11791,11806,11820,11826,11833,11872,11885,11890,11917,11962,12031,12039,12047,12066,12094,12171,12188,12255,12264,12284,12291,12326,12336,12381,12385,12421,12482,12524,12572,12616,12636,12648,12663,12712,12722,12724,12735,12740,12763,12785,12808,12815,12947,13015,13067,13072,13212,13309,13324,13337,13344,13363,13496,13505,13520,13558,13575,13612,13618,13671,13725,13783,13830,13885,13900,13905,13918,13939,14013,14026,14096,14097,14152,14154,14245,14249,14261,14379,14432,14499,14653,14676,14763,14766,14776,14833,14890,14898,14905,14906,15041,15130,15155,15190,15238,15254,15271,15334,15370,15410,15414,15421,15427,15461,15472,15537,15543,15558,15605,15618,15622,15634,15669,15698,15747,15749,15766,15776,15812,15882,15887,16006,16014,16023,16049,16072,16113,16168,16181,16286,16426,16431,16479,16519,16606,16622,16652,16667,16699,16720,16725,16784,16843,16871,16983,17076,17102,17110,17120,17175,17185,17215,17239,17265,17281,17292,17295,17329,17349,17359,17379,17410,17445,17448,17467,17492,17509,17569,17581,17674,17721,17733,17766,17813,17829,17830,17862,17891,17905,17981,18013,18023,18044,18064,18081,18089,18112,18208,18248,18250,18273,18304,18326,18340,18364,18397,18398,18417,18433,18435,18463,18505,18509,18581,18613,18626,18632
)
x.all_features[[11]] <-
c(
62,186,210,322,351,454,484,485,643,666,857,1105,1420,1424,1440,1558,1777,1840,1908,1934,1986,2044,2083,2389,2479,2737,2784,2844,2877,2912,3113,3442,3476,3609,3689,3740,3874,4035,4075,4255,4292,4327,4469,4539,4561,4577,4719,4798,4944,5063,5127,5239,5340,5348,5427,5715,5913,5969,5972,6013,6063,6104,6351,6380,6410,6411,6535,6624,6736,6796,6851,6866,6989,7013,7107,7329,7613,7639,7762,7767,7826,7908,7995,8183,8225,8298,8313,8398,8479,8548,8744,8759,8829,8938,8973,9019,9111,9139,9193,9275,9282,9342,9451,9590,9622,9680,9833,9842,9949,9982,10002,10022,10154,10210,10258,10410,10512,10517,10569,10674,10846,10991,11012,11047,11214,11259,11414,11646,11776,11819,12178,12223,12443,12461,12594,12690,12694,12792,12863,13277,13314,13480,13578,13596,13620,13625,13724,13755,13792,14036,14056,14214,14220,14256,14355,14435,14533,14535,14716,14725,14771,14805,14860,15007,15341,15451,15583,15677,15958,16133,16169,16219,16230,16356,16375,16515,16615,16654,16799,16816,16841,16898,16928,16943,16959,16994,16998,17021,17291,17846,18088,18103,18165,18195,18299,18322,18473
)
x.all_features[[12]] <-
c(
32,398,499,504,775,809,840,885,1162,1198,1203,1258,1318,1413,1470,1502,1532,1620,1839,1846,1861,1915,2136,2416,2701,2822,2832,2869,2926,3185,3201,3275,3337,3632,3776,4169,4182,4237,4324,4462,4519,4578,4667,4772,4917,5143,5234,5244,5272,5279,5428,5520,5602,5699,5749,5787,5805,5827,5868,5870,5873,5889,6070,6154,6229,6235,6292,6710,6726,6790,6985,7041,7084,7221,7272,7300,7325,7331,7428,7435,7698,8035,8199,8264,8319,8419,8541,8579,8619,8623,8663,8698,8712,8790,8843,8965,9131,9162,9461,9485,9567,9614,9646,9680,9715,9782,9819,9865,10162,10252,10273,10306,10884,10885,10927,10930,10937,10947,11107,11133,11255,11301,11654,11696,11875,11879,12092,12135,12157,12169,12202,12424,12433,12508,12596,12695,12725,12874,12936,13012,13217,13305,13431,13523,13613,13617,13649,13656,13836,14001,14019,14233,14482,14583,14630,14662,14681,14884,14900,15059,15100,15183,15587,15615,15838,16011,16013,16045,16173,16244,16391,16393,16408,16493,16558,16603,16626,16993,17011,17360,17377,17397,17534,17622,17806,17868,17934,18150,18330,18518,18545
)

print("done.")

### Training and Kaggle Sets

kaggle.classes <- data.frame()
training.features_train <- data.frame()
training.classes_train <- numeric()
x.cv_mhc <- NA
x.cv_err <- Inf
x.cv_elm <- NA
training.features_ncol <- numeric()
x.loop = NA
x.elm_actv = NA
x.cv_boost <- numeric()
x.avg_err <- 1
x.SPLIT <- 0.4

for (drug_idx in 1:nrow(training.classes))
{
    training.features_train <- cbind(cbind(cbind(training.features,training.features),training.features),training.features)
    training.classes_train <- c(c(c(training.classes[drug_idx,],training.classes[drug_idx,]),training.classes[drug_idx,]),training.classes[drug_idx,])

    ### Cross Validation Loop

    # variables to store loop results
    x.cv_mhc <- NA
    x.cv_err <- Inf
    x.cv_elm <- NA
    training.features_ncol <- round(x.SPLIT * ncol(training.features_train))
    x.cv_boost <- rep(1 / ncol(training.features_train),ncol(training.features_train))
    x.tot_err <- vector()
    x.loop_models <- list(type=any)
    prev_avg <- NA
    x.all_features_cv <- x.all_features[[drug_idx]]

    for (loop in seq(1:100))
    {
        ### Split Training & Validation sets with random sampling (Monte Carlo cross validation)

        # Cross Validation
        index <- sample(1:ncol(training.features_train),round(x.SPLIT * ncol(training.features_train)),replace=TRUE,prob=x.cv_boost)
        training.features_train_cv <- training.features_train[,index]
        training.classes_train_cv <- training.classes_train[index]
        training.features_validation_cv <- training.features_train[,-index]
        training.classes_validation_cv <- training.classes_train[-index]

        print(c("dim training.features_train",dim(training.features_train)))
        print(c("dim training.features_train[,index]",dim(training.features_train[,index])))
        print(c("dim training.features_train[,-index]",dim(training.features_train[,-index])))

        print(c("dim training.features_validation_cv 1",dim(training.features_validation_cv)))

        elm_actv <- "radbas"
        #c(
        #"sig","sin","radbas","hardlim","hardlims","satlins","tansig","tribas","poslin","purelin"
        #)[mod(loop + 2,10) + 1]

        #now we can retain only our selected columns
        training.features_train_w <-
        training.features_train_cv[x.all_features_cv,]

        print(c("dim training.features_validation_cv 2",dim(training.features_validation_cv)))

        #add the class labels to the feature data frame
        training.train_elm_input <-
        data.frame(t(training.features_train_w),check.names = FALSE)

        #train model
        x.model <-
        elmNN::elmtrain(
        x = training.train_elm_input,y = training.classes_train_cv,nhid = 20,actfun = elm_actv
        )

        x.loop_models[[loop]] <- x.model

        ### Validation (on hold out data)

        #filter features
        training.validation_elm_input <-
        data.frame(t(training.features_validation_cv[x.all_features_cv,]), check.names = FALSE)

        x.prediction_cv <-
        predict(x.model,training.validation_elm_input)[,1]

    print(c("loop:",loop))
    #print(c("prev_avg:",prev_avg))
    #print(c("x.prediction_cv:",x.prediction_cv))
    print(c("length prev_avg",length(prev_avg)))
    print(c("length x.prediction_cv",length(x.prediction_cv)))
    print(c("length index",length(index)))
    print(c("length x.cv_boost",length(x.cv_boost)))
    print(c("length training.features_train_cv",length(training.features_train_cv)))
    print(c("length training.features_validation_cv",length(training.features_validation_cv)))
    print(c("dim training.features_train",dim(training.features_train)))

        if(loop > 1)
        {
            prev_avg <- (((loop - 1)/loop) * prev_avg + (1/loop) *  x.prediction_cv)
        }else # loop is 1
        {
            prev_avg <- x.prediction_cv
        }

        x.class_ag <-
        table(round(unlist(lapply(prev_avg,function(x) {
            ifelse(x < 0,0,ifelse(x > 1,1,x))
        }))),training.classes_validation_cv) %>% classAgreement()

        #misclassification rate
        x.err_rate <- 1 - x.class_ag$diag

        #print(c('cv error rate:',x.err_rate))

        x.tot_err <- c(x.tot_err,x.err_rate)

        if (x.err_rate < x.cv_err) {
            x.cv_mhc <- x.all_features_cv
            x.cv_err <- x.err_rate
            x.cv_elm <- x.model
            x.loop <- loop
            x.elm_actv <- elm_actv
        }

        ### Boosting probabilities
        x.cv_boost[-index] <- abs(x.cv_boost[-index] * 2)
    }
    x.avg_err <- c(x.avg_err,x.cv_err)

    print(c("loop:",loop,'avg_err:', x.cv_err))

    ### Predict Kaggle Holdout

    #filter features
    kaggle.elm_input <-
    data.frame(t(kaggle.features[x.cv_mhc,]), check.names = FALSE)

    kaggle.predictions <- predict(x.loop_models[[1]],kaggle.elm_input) / x.loop
    for(loop_it in 2:x.loop)
    {
        kaggle.predictions <- kaggle.predictions + predict(x.loop_models[[loop_it]],kaggle.elm_input) / x.loop
    }
    kaggle.classes <- rbind(kaggle.classes,round(unlist(
    lapply(kaggle.predictions[,1],function(x) {
        ifelse(x < 0,0,ifelse(x > 1,1,x))
    })
    )))
}
rownames(kaggle.classes) <- rownames(training.classes)
colnames(kaggle.classes) <- colnames(kaggle.features)
kaggle.classes %>% str()
mapping <-
read.csv("../data/scoring_and_test_set_id_mappings.csv",check.names = FALSE)
kaggle.out <- data.frame()
for (row in 1:nrow(mapping))
{
    kaggle.out <-
    rbind(kaggle.out,c(mapping[row,"id"],kaggle.classes[(mapping[row,"drug"]),(mapping[row,"cellline"])]))
}
colnames(kaggle.out) <- c('id','value')

fptr <- file(description = "./tuningELM_out.csv",'w')
write.csv(kaggle.out,fptr,row.names = FALSE, quote = FALSE)
close(fptr)

print(
c(
"loop:",drug_idx,"errs:",x.avg_err,"avg_err:",sum(x.avg_err) / length(x.avg_err),"actfun:",x.elm_actv
)
)
